#+TITLE: Krista Victorsen's Emacs configuration
#+AUTHOR: Krista Victorsen
#+PROPERTY: header-args :tangle yes
#+OPTIONS: toc:2
* Bootstrap
 Get emacs off the ground!
** Load-path
*** Config
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/elisp/")
(add-to-list 'load-path (concat user-emacs-directory "literate/tron-doom/"))
#+END_SRC
** use-package: package management management
[[https://github.com/jwiegley/use-package][use-package github]]
#+BEGIN_SRC emacs-lisp
(unless (package-installed-p 'use-package)
  ;; Update the package if it needs updating.
  ;; NOTE: This contacts melpa every time you reload your config. Overhead!
  ;; (package-refresh-contents)
  (package-install 'use-package))
(require 'use-package)
;; All packages in a use-package macro should be automagically installed
(setq use-package-always-ensure t)
#+END_SRC
** Byte-compile external files (if necessary)
- How to byte-compile your entire .emacs.d from the command line:
  #+BEGIN_EXAMPLE 
  emacs -batch -f batch-byte-compile ~/.emacs.d/**/*.el
  #+END_EXAMPLE
  - [[http://emacsredux.com/blog/2013/06/25/boost-performance-by-leveraging-byte-compilation/][Source]]
- auto-compile mode
  #+BEGIN_SRC emacs-lisp
  ;;; init.el --- user init file      -*- no-byte-compile: t -*-
  (use-package auto-compile
    ;; NOTE: This will only re-compile existing .elc files, so you must
    ;; run the shell command above for one-time install on new machines
    :config (auto-compile-on-load-mode))
  (setq load-prefer-newer t)
  #+END_SRC
** Literate programming support
- NOTE: you /must/ have each tangle block on a new line in order for it
  to be tangled correctly!!!!
- NOTE: It is important that use-package has been loaded before this
  block is executed
- This is because my external files have "use-package" statements,
  which won't work if use-package hasn't been loaded yet!
*** Tangling helpers
#+BEGIN_SRC emacs-lisp
(setq-default krista/org-config-directory "literate")
(setq-default krista/org-config-dirpath
              (expand-file-name (concat user-emacs-directory
                                        krista/org-config-directory)))
(add-to-list 'load-path krista/org-config-dirpath)
(setq-default krista/config-org-files nil)

;; transforms the given name to "krista/name-config-file" and sets it
;; to the given org filename
(defmacro krista/new-config-file (name filename)
  (let ((full-file (make-symbol "full-filename")))
    `(let ((,full-file
            (concat (file-name-as-directory krista/org-config-dirpath)  ,filename ".org")))
       (defvar ,(intern (concat "krista/" (symbol-name name) "-config-file"))
         ,full-file)
       (add-to-list
        (quote krista/config-org-files) (quote (,name . ,filename)) t))))
#+END_SRC
*** Now actually tangle the external files
- NOTE: It is important that use-package has been loaded before this
  block is executed
- This is because my external files have "use-package" statements,
  which won't work if use-package hasn't been loaded yet!
**** OS-specific config
#+BEGIN_SRC emacs-lisp
(krista/new-config-file macOS "macOS")
(krista/new-config-file windows "windows")
(cond ((eq system-type 'darwin)
       (org-babel-load-file krista/macOS-config-file))
      ((member system-type '(ms-dos windows-nt cygwin))
       (org-babel-load-file krista/windows-config-file)))
#+END_SRC
**** Modeline
#+BEGIN_SRC emacs-lisp
(krista/new-config-file modeline "modeline")
(org-babel-load-file krista/modeline-config-file)
#+END_SRC
**** LaTeX
***** COMMENT Krista config
#+BEGIN_EXAMPLE
;; (krista/new-config-file krista-latex "krista-latex")
;; (org-babel-load-file krista/krista-latex-config-file)
(message "[krista] Loading tex...")

;; AUCTEX
;; auctex provides package tex
(use-package tex
  :ensure auctex
  :config
  (setq TeX-auto-save t)         ; save buffer style info
  (setq TeX-parse-self t)        ; automatically parse style info
  (setq TeX-auto-untabify t)     ; no tabs
  (setq-default TeX-master t)    ; default master TeX file == current buffer
  (setq TeX-PDF-mode t)          ; TODO: what does this do?
  (setq TeX-save-query nil)      ; TODO: what does this do?
  (setq TeX-error-overview-open-after-TeX-run t) ; show errors (if any)
  (setq TeX-auto-local ".auctex-auto") ; give builtin var a better name

  ;; Don't ask permission before running TeX shell commands
  (put 'TeX-command-extra-options 'safe-local-variable
       (lambda (x) (string-equal x "-shell-escape")))

  ;; TODO: document this better
  (defun krista/TeX-open-output-buffer ()
    (interactive)
    (let ((output-file (with-current-buffer TeX-command-buffer
                         (expand-file-name
                          (TeX-active-master
                           (TeX-output-extension))))))
      (find-file output-file)))
  (add-to-list 'TeX-view-program-list
               (list "Emacs" #'krista/TeX-open-output-buffer))
  (setq TeX-view-program-selection '((output-pdf "Emacs")))

  ;; TODO: better docs for this function
  ;; auto revert pdf buffer
  (add-hook 'TeX-after-compilation-finished-functions 
            #'TeX-revert-document-buffer)

  ;; Don't confirm before cleaning files
  (setq TeX-clean-confirm nil)
  (defun tex-runall-clean ()
    (interactive)
    (TeX-command-run-all nil)
    (TeX-clean))

  (defun TeX-insert-pair (arg open-str close-str)
    "Like TeX-insert-brackes but for any pair"
    (interactive "P")
    (if (TeX-active-mark)
        (progn
          (if (< (point) (mark)) (exchange-point-and-mark))
          (insert close-str)
          (save-excursion (goto-char (mark)) (insert open-str)))
      (insert open-str)
      (save-excursion
        (if arg (forward-sexp (prefix-numeric-value arg)))
        (insert close-str))))

  ;; Insert inline/display math quickly
  (defun LaTeX-insert-inline-math (arg)
    (interactive "P")
    (TeX-insert-pair arg "\\( " " \\)"))
  (defun LaTeX-insert-display-math (arg)
    (interactive "P")
    (TeX-insert-pair arg "\\[ " " \\]"))
  (defun LaTeX-mode-keybindings ()
    (local-set-key (kbd "H-C-j") #'LaTeX-insert-inline-math)
    (local-set-key (kbd "H-C-k") #'LaTeX-insert-display-math))
  (add-hook 'LaTeX-mode-hook #'LaTeX-mode-keybindings)
  (defun krista/TeX-mode-keybindings ()
    (local-set-key (kbd "C-c b") #'tex-runall-clean)
    (local-set-key (kbd "H b") #'LaTeX-math-bar))
  (add-hook 'TeX-mode-hook #'TeX-mode-keybindings)
  ;; Highlight other (closing/opening) paren
  (setq latex-electric-env-pair-mode t)
  ;; Auto-insert braces after ^ and _ in math mode
  (setq TeX-electric-sub-and-superscript t)


  (defun my-latex-settings (interactive)
    (set-fill-column 80)             ; Wrap lines at n characters
    (turn-on-auto-fill)              ; Automatically wrap lines
    (prettify-symbols-mode)          ; Automatically render unicode
    )
  (add-hook 'LaTeX-mode-hook 'my-latex-settings)
  ) ;; close use-package tex


;; (message "[krista] Loading latex...")
;; (use-package latex
;;   :ensure nil
;;   :config
  ;; (setq visual-line-mode t)
  ;; (setq LaTeX-math-menu-unicode t)
  ;; (setq LaTeX-math-mode t)
  ;; ) ;; Close use-package latex
;; (add-hook 'LaTeX-mode-hook 'LaTeX-math-mode)

;; (use-package reftex
;;   :diminish reftex-mode
;;   :config
;;   (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
;;   (setq reftex-plug-into-AUCTeX t))
#+END_EXAMPLE
***** Spruce config
#+BEGIN_EXAMPLE
  ;; Project github: https://github.com/politza/pdf-tools
  ;; Source: https://emacs.stackexchange.com/a/22591
  ;;; Install epdfinfo via 'brew install pdf-tools' and then install the
  ;;; pdf-tools elisp via the use-package below. To upgrade the epdfinfo
  ;;; server, just do 'brew upgrade pdf-tools' prior to upgrading to newest
  ;;; pdf-tools package using Emacs package system. If things get messed
  ;;; up, just do 'brew uninstall pdf-tools', wipe out the elpa
  ;;; pdf-tools package and reinstall both as at the start.
  (use-package pdf-tools
    :ensure t
    :config
    (custom-set-variables
      '(pdf-tools-handle-upgrades nil)) ; Use brew upgrade pdf-tools instead.
    (setq pdf-info-epdfinfo-program "/usr/local/bin/epdfinfo"))
  (pdf-tools-install)

  (use-package tex
    :ensure auctex
    :defer 5
    :config
    ;; TODO: fucks up prettify for some reason?
    ;; (company-auctex-init)
    ;; save buffer style info
    (setq TeX-auto-save t)
    ;; automatically parse style info
    (setq TeX-parse-self t)
    ;; no tabs
    (setq TeX-auto-untabify t)
    ;; TODO: unsure what this does
    ;; (setq-default TeX-master 'dwim)
    (setq TeX-PDF-mode t)
    (defun spruce/TeX-open-output-buffer ()
      (interactive)
      (let ((output-file (with-current-buffer TeX-command-buffer
                           (expand-file-name
                            (TeX-active-master (TeX-output-extension))))))
        (find-file output-file)))
    (add-to-list 'TeX-view-program-list
                 (list "Emacs" #'spruce/TeX-open-output-buffer))

    (setq TeX-view-program-selection '((output-pdf "Emacs")))
    (defun latex-compile ()
      (interactive)
      (save-buffer)
      (TeX-command "LaTeX" 'TeX-master-file))

    (setq TeX-auto-local ".auctex-auto")
    ;; auto revert pdf buffer
    (add-hook 'TeX-after-compilation-finished-functions
              #'TeX-revert-document-buffer)
    ;; show errors if there were any
    (setq TeX-error-overview-open-after-TeX-run t)
    ;; don't confirm before cleaning files
    (setq TeX-clean-confirm nil)
    (setq TeX-save-query nil)
    (defun TeX-insert-pair (arg open-str close-str)
      "Like TeX-insert-brackes but for any pair"
      (interactive "P")
      (if (TeX-active-mark)
          (progn
            (if (< (point) (mark)) (exchange-point-and-mark))
            (insert close-str)
            (save-excursion (goto-char (mark)) (insert open-str)))
        (insert open-str)
        (save-excursion
          (if arg (forward-sexp (prefix-numeric-value arg)))
          (insert close-str))))
    (setq TeX-electric-sub-and-superscript t)
    (put 'TeX-command-extra-options 'safe-local-variable
         (lambda (x) (string-equal x "-shell-escape")))
    (setq-default TeX-command-extra-options "-shell-escape")

    (use-package latex
      :ensure nil
      :config
      (add-hook 'LaTeX-mode-hook 'LaTeX-math-mode)
      (setq LaTeX-math-menu-unicode t)
      (add-hook 'LaTeX-mode-hook (lambda () (latex-electric-env-pair-mode t)))
      (add-hook 'LaTeX-mode-hook
                (lambda () (set-fill-column 90)))
      (add-hook 'LaTeX-mode-hook 'turn-on-auto-fill)
      (add-hook 'LaTeX-mode-hook (lambda () (prettify-symbols-mode)))

      (defun spruce/LaTeX-insert-inline-math (arg)
        (interactive "P")
        (TeX-insert-pair arg "\\( " " \\)"))
      (defun spruce/LaTeX-insert-display-math (arg)
        (interactive "P")
        (TeX-insert-pair arg "\\[ " " \\]"))

      (defun spruce/LaTeX-insert-problem (problem-number &optional is-last)
        (beginning-of-line)
        (let ((problem (concat "\\problem{" problem-number "}"))
              (unfinished "\\unfinished{}"))
          (insert problem "\n\n" unfinished "\n"
                  (if is-last "" "\n"))))

      (defun spruce/LaTeX-make-problem-list ()
        (interactive)
        (let ((data (split-string (thing-at-point 'line t))))
          (when data
            (delete-region (line-beginning-position)
                           (line-end-position))
            (mapc #'spruce/LaTeX-insert-problem (butlast data))
            (spruce/LaTeX-insert-problem (car (last data)) t))))

      (defun spruce/LaTeX-mode-keybindings ()
        (bind-key "H-C-j" #'spruce/LaTeX-insert-inline-math
                  (current-local-map))
        (bind-key "H-C-k" #'spruce/LaTeX-insert-display-math
                  (current-local-map))
        (bind-key "C-c x p" #'spruce/LaTeX-make-problem-list
                  (current-local-map))
        (local-unset-key "\""))

      (add-hook 'LaTeX-mode-hook #'spruce/LaTeX-mode-keybindings)
      (with-eval-after-load 'smartparens
        (add-hook 'TeX-mode-hook #'smartparens-mode))
      (use-package font-latex
        :ensure nil
        :config
        (set-face-attribute 'font-latex-sedate-face nil
                            :inherit 'font-lock-constant-face
                            :foreground 'unspecified))
      :bind (:map LaTeX-mode-map
             ("C-!" . latex-compile))))

  ;; (use-package reftex
  ;;   :diminish reftex-mode
  ;;   :config
  ;;   (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
  ;;   (setq reftex-plug-into-AUCTeX t))

  ;; (setq latex-templates-directory (with-user-d "templates" "latex-templates"))
  ;; (defun latex-template ()
  ;;   (interactive)
  ;;   (let* ((files (file-expand-wildcards (concat latex-templates-directory "*.tex")))
  ;;          (selection (completing-read "LaTeX Template: "
  ;;                                      (mapcar #'file-name-base files))))
  ;;     (insert-file-contents (concat latex-templates-directory selection ".tex"))))
#+END_EXAMPLE
** Initial buffer to show at startup
- When I start up emacs, I don't want to see the ugly default startup
  screen. However, I also want to be able to run =emacs somefile.txt=
  and start editing =somefile.txt= right away. As a compromise, I check
  if there were arguments passed in to emacs at startup. If not, set
  the initial-buffer-choice to my core directory.
  - [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Entering-Emacs.html#Entering-Emacs][More on initial buffers]]
  - [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Command_002dLine-Arguments.html][More on command line arguments]]
- Config (via [[https://emacs.stackexchange.com/a/21106][stackexchange]])
  #+BEGIN_SRC emacs-lisp
  (setq krista/todo-file "~/core/lists/todo.org")
  (setq krista/at-a-glance-file "~/core/school/umich/F17/at-a-glance.org")
  (setq krista/schedule-file "~/core/school/umich/F17/schedule.png")
  (setq default-initial-buffer-choice krista/todo-file)
  (defun my-after-init-hook ()
    "Set initial buffer ONLY if no file is specified in command line args"
    (when (eq 1 (length command-line-args))
      (message "[krista] Setting initial buffer to default value")
      (setq initial-buffer-choice default-initial-buffer-choice)))
  (add-hook 'after-init-hook 'my-after-init-hook)
  #+END_SRC
* Tools for configuring emacs
This is where I put things that help me modify my emacs install more efficiently
** Quickly open, evaluate my config file
#+BEGIN_SRC emacs-lisp
(defun krista/open-config ()
  "Quickly open my config file"
  (interactive)
  (find-file (or "~/.emacs.d/config.org"
                 user-init-file "")))
(bind-key "C-c e" #'krista/open-config)

(defun krista/eval-config ()
  "Quickly evaluate my config file"
  (interactive)
  (load-file user-init-file))
(bind-key "C-c C-h" #'krista/eval-config)
#+END_SRC
** Evaluate a region, or the buffer (whatever's appropriate)
#+BEGIN_SRC emacs-lisp
(defun eval-region-or-buffer ()
  "Let me eval either a region or a buffer at a time"
  (interactive)
  (let ((debug-on-error t))
    (cond
     (mark-active
      (call-interactively 'eval-region)
      (message "Region evaluated!")
      (setq deactivate-mark t))
     (t
      (eval-buffer)
      (message "Buffer evaluated!")))))
(add-hook 'emacs-lisp-mode-hook
          (lambda ()
            (bind-key "C-c C-b" #'eval-region-or-buffer)))
#+END_SRC
** Switch to *Messages* buffer
#+BEGIN_SRC emacs-lisp
(defun switch-to-messages-buffer ()
  "Open up the *Messages* buffer in a new frame"
  (interactive)
  (switch-to-buffer-other-window "*Messages*"))
(bind-key "C-c m" #'switch-to-messages-buffer)
#+END_SRC
** Record keyboard macros
#+BEGIN_SRC emacs-lisp
;; Start & end recording new keyboard macro
(bind-key "M-[" #'kmacro-start-macro)
(bind-key "M-]" #'kmacro-end-macro)
;; Call the last keyboard macro that was recorded
(bind-key "C-l" #'call-last-kbd-macro)
#+END_SRC
** Quickly open melpa
#+BEGIN_SRC emacs-lisp
;; Speedy-open melpa
(use-package paradox
  :bind (("H-p" . paradox-list-packages)))
#+END_SRC
** Emacs achievements
- Unlock achievements to track your emacs journey
- [[https://bitbucket.org/gvol/emacs-achievements/src/5b4b7b6816aaf105cd493f51b3860bd2f0c014a6/README.md?at=default&fileviewer=file-view-default][Bitbucket]]
#+BEGIN_SRC emacs-lisp
(use-package achievements
  :diminish achievements-mode
  :config (achievements-mode t))
#+END_SRC
** Freekeys
#+BEGIN_SRC emacs-lisp
(use-package free-keys
  :bind ("M-F" . free-keys))
#+END_SRC
** Benchmark init
- Figure out where you're burning time!!!
- [[https://www.emacswiki.org/emacs/BenchmarkInit][docs]]
- config
  #+BEGIN_SRC emacs-lisp
  (require 'benchmark-init)
  #+END_SRC
** Make Customize sort colors in a way that makes sense to me
#+BEGIN_SRC emacs-lisp
(setq list-colors-sort 'luminance)
#+END_SRC
** Funnel settings from Customize into another file
#+BEGIN_SRC emacs-lisp
;; Save the pesky Custom options elsewhere! (i.e. in user-emacs-directory/custom.el)
(setq custom-file (expand-file-name "custom.el" user-emacs-directory))
;; Uncomment this ONLY if you want to see the pesky Custom options. They *are* saved, although they're not loaded
;; (load custom-file :noerror)
#+END_SRC
** Identify the face under the cursor
Source: https://stackoverflow.com/a/1242415
#+BEGIN_SRC emacs-lisp
(defun what-face (pos)
  (interactive "d")
  (let ((face (or (get-char-property (point) 'read-face-name)
                  (get-char-property (point) 'face))))
    (if face (message "Face: %s" face) (message "No face at %d" pos))))
#+END_SRC
* Global settings
** Better defaults
*** Remove default startup message, text at the top of scratch buffers
#+BEGIN_SRC emacs-lisp
(setq inhibit-startup-message t)
(setq initial-scratch-message "")
(setq inhibit-startup-screen t)
#+END_SRC
*** Don't warn me before opening large files
#+BEGIN_SRC emacs-lisp
(setq large-file-warning-threshold nil)
#+END_SRC
*** Remove the default emacs toolbar (top of screen)
#+BEGIN_SRC emacs-lisp
(tool-bar-mode -1)
#+END_SRC
*** Hide the scrollbar
#+BEGIN_SRC emacs-lisp
(scroll-bar-mode -1)
#+END_SRC
*** When cursor is on a paren, highlight the other one 
#+BEGIN_SRC emacs-lisp
(show-paren-mode 1)
(setq show-paren-delay 0)
#+END_SRC
*** Put /relevant/ info in the title bar
Set the format for the title bar
- Disambiguation: 
  - An example [[https://cdn1.tekrevue.com/wp-content/uploads/2015/09/osx-finder-path-in-title-bar.jpg][window title bar]] in macOS
  - macOS calls this thing a "window title"
  - emacs calls this thing a "frame title"
- See also: https://www.emacswiki.org/emacs/FrameTitle
#+BEGIN_SRC emacs-lisp
;; %b - Buffer name
;; %m - Buffer mode
(setq frame-title-format '("%b - [%m]"))
#+END_SRC
*** Don't try to edit read-only portions of the minibuffer
Source: http://ergoemacs.org/emacs/emacs_stop_cursor_enter_prompt.html
#+BEGIN_SRC emacs-lisp
(customize-set-variable
 'minibuffer-prompt-properties
 (quote (read-only t cursor-intangible t face minibuffer-prompt)))
#+END_SRC
*** Don't litter working directory with backup files
#+BEGIN_SRC emacs-lisp
(setq
   backup-by-copying t      ; don't clobber symlinks
   backup-directory-alist
    '((".*" . "~/.emacs.d/backup/"))    ; don't litter my filesystem
   delete-old-versions t
   kept-new-versions 50
   kept-old-versions 50
   version-control t)       ; use versioned backups
#+END_SRC
*** Don't litter working directory with autosave files
#+BEGIN_SRC emacs-lisp
(setq auto-save-file-prefix "~/.emacs.d/autosaves/.saves-")
(setq auto-save-interval 1000) ; 1000 characters
(setq auto-save-timeout 60)    ; or 60 seconds
#+END_SRC
*** Delete highlighted text if you start typing on top of it
#+BEGIN_SRC emacs-lisp
(delete-selection-mode 1)
#+END_SRC
*** Change "yes or no" prompts to "y or n" prompts
#+BEGIN_SRC emacs-lisp
(defalias 'yes-or-no-p 'y-or-n-p)
#+END_SRC
*** Don't add 2 spaces after a period
#+BEGIN_SRC emacs-lisp
(setq sentence-end-double-space nil)
#+END_SRC
** Getting around
See also: [[*Ace-window]]
*** Don't scroll a full screenful at a time
Keep some "context lines" around
#+BEGIN_SRC emacs-lisp
(setq next-screen-context-lines 3)
#+END_SRC
*** Cycle backwards through buffers
"C-x o", meet your new friend "C-c o"!
#+BEGIN_SRC emacs-lisp
(bind-key "C-c o" #'previous-multiframe-window)
#+END_SRC
*** Toggle fullscreen
Note: this resizes the frame, but does not enter the OS's native fullscreen mode
#+BEGIN_SRC emacs-lisp
(bind-key "C-c C-<return>" #'toggle-frame-fullscreen)
#+END_SRC 
*** Forbid vertical splitting
https://stackoverflow.com/questions/24140672/how-can-i-make-ess-to-split-window-horizontally-by-default
Not quite what I want, but helpful
#+BEGIN_SRC emacs-lisp
;; (setq split-height-threshold nil)
;; (setq split-width-threshold 0)
#+END_SRC
** Editing
- This section contains variable settings and functions.
- Rebind preexisting commands in [[*Global%20keybindings][*Global keybindings]]
*** Backwards kill-line
- It's the backwards version of C-k
- Note: M-k was originally bound to =kill-sentence=
- Source: https://www.emacswiki.org/emacs/BackwardKillLine
#+BEGIN_SRC emacs-lisp
(defun backward-kill-line (arg)
  "Kill ARG lines backward."
  (interactive "p")
  (kill-line (- 1 arg)))
(bind-key "M-k" #'backward-kill-line)
#+END_SRC
*** Make C-k kill the text AND newline
#+BEGIN_SRC emacs-lisp
(setq kill-whole-line t)
#+END_SRC
*** Transpose line up or down
#+BEGIN_SRC emacs-lisp
(defun move-line-up ()
  "Move up the current line."
  (interactive)
  (transpose-lines 1)
  (forward-line -2)
  (indent-according-to-mode))
(defun move-line-down ()
  "Move down the current line."
  (interactive)
  (forward-line 1)
  (transpose-lines 1)
  (forward-line -1)
  (indent-according-to-mode))
(global-set-key (kbd "M-p")  'move-line-up)
(global-set-key (kbd "M-n")  'move-line-down)
#+END_SRC
*** Comment out the current line
Source: http://www.opensubscriber.com/message/emacs-devel@gnu.org/10971693.html
#+BEGIN_SRC emacs-lisp
(defun comment-dwim-line (&optional arg)
  "Replacement for the comment-dwim command.
       If no region is selected and current line is not blank and we are not at the end of the line,
       then comment current line.
       Replaces default behaviour of comment-dwim, when it inserts comment at the end of the line."
  (interactive "*P")
  (comment-normalize-vars)
  (if (and (not (region-active-p))
           (not (looking-at "[ \t]*$")))
      (comment-or-uncomment-region (line-beginning-position)
                                   (line-end-position))
    (comment-dwim arg)))
(bind-key "M-;" #'comment-dwim-line)
#+END_SRC
** Global keybindings
#+BEGIN_SRC emacs-lisp
;; Eval buffer
(bind-key "C-c b" #'eval-buffer)

;; Count words in selected region

(bind-key "C-c w" #'count-words)
;; 23 Mar 2016 - binds "M-j" to "M-x-join-line", as per
;; <http://stackoverflow.com/questions/1072662/by-emacs-how-to-join-two-lines-into-one>
(bind-key "M-j" #'join-line)

;; Unbind Ctrl+meta+<right>, Ctrl+meta+<left> so BTT can use that to
;;bring a window to a new desktop
(global-unset-key (kbd "C-M-<left>"))
(global-unset-key (kbd "C-M-<right>"))
#+END_SRC
** Enable hidden commands
#+BEGIN_SRC emacs-lisp
;; Enable "C-x u" for upcase-region, "C-x l" for downcase-region
(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
#+END_SRC
* Appearance
** Aesthetic tweaks
*** Set cursor appearance
Note: changing the cursor-type does not take effect until emacs is restarted,
because it only sets the /default/ cursor type. I have not yet figured
out how to set it immediately, but this should suffice as startup config.
#+BEGIN_SRC emacs-lisp
(setq-default cursor-type 'bar)
(setq-default cursor-in-non-selected-windows 'hollow)
#+END_SRC
*** Change the fringe wrap indicators
- Fringe wrap indicators are used to show that a line is wider than
  the current window. 
- The default fringe wrap indicators are a curly arrow
- I prefer an elipsis:
  #+BEGIN_SRC emacs-lisp
   ;; Only relevant if indicate-empty-line is set to t
   (define-fringe-bitmap 'empty-line [0 0 #x3c #x3c #x3c #x3c 0 0]) 

   (define-fringe-bitmap 'right-curly-arrow
     [#b00000000
      #b00000000
      #b00000000
      #b00000000
      #b00000000
      #b10010010
      #b10010010
      #b00000000])

   (define-fringe-bitmap 'left-curly-arrow
     [#b00000000
      #b00000000
      #b00000000
      #b00000000
      #b00000000
      #b10010010
      #b10010010
      #b00000000])

  (setq visual-line-fringe-indicators (quote (left-curly-arrow right-curly-arrow)))
  #+END_SRC
*** Hide the fringe
#+BEGIN_SRC emacs-lisp
(set-face-attribute 'fringe nil :background "#001519")
;;(set-face-attribute 'vertical-border nil :foreground "#cf7a00")
#+END_SRC
*** Fonts
#+BEGIN_SRC emacs-lisp
(set-face-attribute 'default nil :font "Fira Code-13")
(set-face-attribute 'bold nil :weight 'extra-bold)

(set-face-attribute 'bold-italic nil
                    :slant 'oblique
                    :weight 'bold)

(set-face-attribute 'font-lock-doc-face nil
                    :foreground "#58615a"
                    :family "Fira Code")

(set-face-attribute 'region nil :background "#032929")

#+END_SRC
** Theme
#+BEGIN_SRC emacs-lisp
;; Load my theme
(add-to-list 'custom-theme-load-path (concat user-emacs-directory "literate/tron-doom/"))
(load-theme 'tron-doom t) ; t for "don't ask me to load this theme"

;; Global settings (defaults)
(setq doom-themes-enable-bold t    ; if nil, bold is universally disabled
      doom-themes-enable-italic t) ; if nil, italics is universally disabled

;; Enable flashing mode-line on errors
(doom-themes-visual-bell-config)

;; Set different faces for TODO items with different priority levels
;; Source: https://emacs.stackexchange.com/a/17405
(setq org-priority-faces '((?A . (:foreground "#cf7a00" :weight 'extrabold))
                          (?B . (:foreground "#00a890" :weight 'bold))
                          (?C . (:foreground "#075f5f"))))

#+END_SRC

* Major packages
** Org-mode
*** Config
#+BEGIN_SRC emacs-lisp :noweb tangle
(message "[krista] Loading org-mode settings...")
(use-package org
  :diminish org-indent-mode
  :config
  (message "[krista] Loading org-aesthetics...")
  <<org-aesthetics>>
  (message "[krista] Loading org-capture...")
  <<org-capture>>
  (message "[krista] Loading org-agenda...")
  <<org-agenda>>
  (message "[krista] Loading org-inline-images...")
  <<org-inline-images>>
  (message "[krista] Loading org-tree-behavior...")
  <<org-tree-behavior>>
  (message "[krista] Loading org-code-snippets...")
  <<org-code-snippets>>
  (message "[krista] Loading org-links...")
  <<org-links>>
  (message "[krista] Loading org-tables...")
  <<org-tables>>
  :bind (
         ("C-c c" . org-capture)
         ("C-c a" . org-agenda)

         ;; Links!
         ;; - C-c C-l will insert link,
         ;; - C-c C-o will open the link at the point
         ("C-c l" . org-store-link)

         ;; Keybindings that insert inline / display math
         ;; into org docs, s.t. everything will export to
         ;; LaTeX nicely:
         ;; NOTE: These shortcuts match up with my shortcuts
         ;;       for inserting inline / display math into
         ;;       regular LaTeX docs. This is to provide as
         ;;       seamless an experience as I can muster.
         ("H-C-j" . LaTeX-insert-inline-math)
         ("H-C-k" . LaTeX-insert-display-math)))
#+END_SRC
*** Tips from http://orgmode.org/worg/org-tutorials/orgtutorial_dto.html
**** todo / schedule / deadline
- C-c C-t :: org-todo
- C-c C-s :: org-schedule
- C-c C-d :: org-deadline
- M-shift-RET :: org-insert-todo-heading
  - Adds newline
  - Adds bullet at same indentation level
  - Bullet automatically has a `TODO' header
**** agenda view:
- hit `t' to mark an item DONE
- hit `l' to enter log display
**** shift-TAB :: OVERVIEW vs. normal mode
*** Aesthetics
#+BEGIN_SRC emacs-lisp :noweb-ref org-aesthetics :tangle no
;; Display bullets instead of asterisks
(use-package org-bullets
  :diminish
  :config
  (setq org-bullets-bullet-list (quote ("⊕" "⦷" "⊜" "⊝"))))
(add-hook 'org-mode-hook (lambda () (org-bullets-mode t)))

;; Setting this to `t' will automatically render LaTeX special
;; characters, if possible/sensible
;; E.g. "\" + "alpha" becomes a lowercase alpha
;; I have it turned off, but it's here
(setq org-pretty-entities t)

;; Setting this to `t' will use {} to render sub/super-scripts
;; e.g. asdf_{123} is rendered as "asdf sub 123"
;; I have it turned off, but it's here
(setq org-use-sub-superscripts "{}")

;; Hide org markup elements
;; See http://stackoverflow.com/questions/10969617/hiding-markup-elements-in-org-mode
;; Note: This change may not take effect until you restart emacs:
;; See http://orgmode.org/manual/Emphasis-and-monospace.html
(setq org-hide-emphasis-markers t)

;; Make top-level headings larger, and lower-level headings progressively smaller
;; (set-face-attribute 'org-level-1 nil :inherit 'outline-1 :height 1.2)
;; (set-face-attribute 'org-level-2 nil :inherit 'outline-2 :height 1.0)

;; Use my theme as the color scheme for source blocks
(setq org-src-fontify-natively t)

;; Don't add a weird indent to source blocks
(setq org-src-preserve-indentation nil
      org-edit-src-content-indentation 0)

;; Org mode clean view
;; <http://orgmode.org/manual/Clean-view.html>
(setq org-startup-indented t)

;; When you visit an agenda for the first time, still honor my startup preferences
(setq org-agenda-inhibit-startup nil)

;; in org mode C-a/e moves to beginning of text in line, after header asterisks
;; however you can press it again to go all the way
(setq org-special-ctrl-a/e t)

;; Set default size for org tables
(setq org-table-default-size "2x3")

(set-face-attribute 'org-code nil
                    :inherit 'shadow
                    :foreground "dark sea green"
                    :family "Courier")

(set-face-attribute 'org-verbatim nil
                    :inherit 'shadow
                    :stipple nil
                    :foreground "AntiqueWhite4"
                    :family "Andale Mono")

;; Custom Org keywords
;; Multiple workflows: in-built TODO system, packing/moving
(setq krista/packing-mode nil)
(if krista/packing-mode
    (setq org-todo-keywords
          '((sequence "TODO(t)" "|" "DONE(d)" "CANCELLED(c)")
            (sequence "GATHER(g)" "PACK(p)" "|" "LOAD(l)" "UNPACK(u)")))
  (setq org-todo-keywords
        '((sequence "TODO" "|" "DONE" "CANCELLED"))))
;; Org todo keyword faces
(setq org-todo-keyword-faces '(("TODO" . (:foreground "#ff0f97" :weight bold))
                               ("DONE" . (:foreground "#075f5f" :weight bold))
                               ("CANCELLED") . (:foreground "#888a85" :weight bold)))
#+END_SRC
*** Exporting to LaTeX
#+BEGIN_SRC emacs-lisp
;; Put newlines around my images, please!
;; http://emacs.stackexchange.com/questions/5363/centered-figures-in-org-mode-latex-export?rq=1
(advice-add 'org-latex--inline-image :around
            (lambda (orig link info)
              (concat
               "\\begin{center}"
               (funcall orig link info)
               "\\end{center}")))
#+END_SRC
*** Org-capture
#+BEGIN_SRC emacs-lisp :noweb yes :noweb-ref org-capture :tangle yes
;; Org capture
(setq org-default-notes-file (concat org-directory "/notes.org"))
;; To see what goes into an org-capture template, see
;; http://orgmode.org/manual/Template-expansion.html#Template-expansion
(setq org-capture-templates
      '(("a" "annoy" entry
         (file+olp krista/todo-file "annoy" "refile")
         "* %?\n %i\n")
        ("h" "hw-style-guide" entry
         (file+olp "~/core/school/powerpoint_shaming/tacky_hw_things.org" "tacky!")
         "* %?\n %i\n")
        ("m" "movies" entry
         (file+olp "~/core/lists/movies.org" "refile")
         "* %?\n %i\n")
        ("q" "quotes" entry
         (file+olp "~/core/lists/quotes.org" "quotes")
         "* %?\n %i\n")
        ("s" "shopping" entry
         (file+olp krista/todo-file "shopping")
         "* %?\n %i\n")
        ("t" "todo" entry
         (file+olp krista/todo-file "todo-queue")
         "* TODO %?\n %i\n")
        ("u" "how to deal with umich" entry
         (file+olp "~/core/lists/advice" "how to deal with umich")
         "* %?\n %i\n")
        ("v" "advice" entry
         (file+olp "~/core/lists/advice" "refile")
         "* %?\n %i\n")
        ("w" "workflow advice" entry
         (file+olp "~/core/lists/advice" "workflow advice")
         "* %?\n %i\n")
        ))
<<org-refile-targets>>
#+END_SRC
**** Org refile targets
#+BEGIN_SRC emacs-lisp :noweb-ref org-refile-targets :tangle no
(setq org-refile-use-outline-path t) ; Show full paths for refiling 
(setq org-refile-allow-creating-parent-nodes (quote confirm)) ; allow refile to create parent tasks with confirmation

;; Source:
;; https://emacs.stackexchange.com/questions/22128/how-to-org-refile-to-a-target-within-the-current-file?rq=1
;; Hmm. This only lets you pick from the buffer that you're currently visiting,
;; but I want the file specified by the org capture template
;; (defun my-org-files-list ()
;;  (delq nil
;;    (mapcar (lambda (buffer)
;;      (buffer-file-name buffer))
;;      (org-buffer-list 'files t))))

(setq org-refile-targets '((org-agenda-files :maxlevel . 2)))
#+END_SRC
*** Org todo/agenda
#+BEGIN_SRC emacs-lisp :noweb-ref org-agenda :tangle no
;; Places to sniff when compiling a list of TODO items
(setq org-agenda-files (list krista/todo-file
                             krista/at-a-glance-file))

;; From http://orgmode.org/manual/Breaking-down-tasks.html 
;;
;; When showing progress stats for TODO completion, recursively
;; consider the entire subtree
(setq org-hierarchical-todo-statistics nil)
;;
;; "If you would like a TODO entry to automatically change to DONE
;; when all children are done, you can use the following setup:"
(defun org-summary-todo (n-done n-not-done)
  "Switch entry to DONE when all subentries are done, to TODO otherwise."
  (let (org-log-done org-log-states)   ; turn off logging
    (org-todo (if (= n-not-done 0) "DONE" "TODO"))))

(add-hook 'org-after-todo-statistics-hook 'org-summary-todo)

;; Source https://emacs.stackexchange.com/a/19876
(setq-default org-display-custom-times t)
(setq org-time-stamp-custom-formats '("<%A %b %e %Y>" . "<%A %b %e %Y %l:%M%p>"))
#+END_SRC
*** inline images
#+BEGIN_SRC emacs-lisp :noweb-ref org-inline-images :tangle no
;; Let me resize them plz!
(setq org-image-actual-width '(500))
;; => if there is a #+ATTR.*: width="200", resize to 200,
;;     otherwise resize to 500 pixels wide
;; link credit: http://lists.gnu.org/archive/html/emacs-orgmode/2012-08/msg01388.html

;; By default, *do* display inline images
(setq org-startup-with-inline-images t)
#+END_SRC
*** Tweaks to tree behavior
Use shift+meta-<right>, to get lateral shifts (demotion/promotion) that apply to the whole subtree!
#+BEGIN_SRC emacs-lisp :noweb-ref org-tree-behavior :tangle no
;; Source: Spruce Bondera
(defun krista/org-cycle-current-subtree ()
  (interactive)
  (let ((old-tab-style org-cycle-emulate-tab))
    (setq org-cycle-emulate-tab nil)
    (org-cycle)
    (setq org-cycle-emulate-tab old-tab-style)))
(bind-key "C-<tab>" #'krista/org-cycle-current-subtree)
#+END_SRC
*** Code snippets in org
#+BEGIN_SRC emacs-lisp :noweb-ref org-code-snippets :noweb tangle :tangle yes
<<org-quick-source-blocks>>
<<org-babel-config>>
#+END_SRC
**** Quickly add source blocks
Example: Start a new elisp block in org mode by typing <el and then pressing TAB
***** Config
#+BEGIN_SRC emacs-lisp :noweb-ref org-quick-source-blocks :tangle no
(add-to-list 'org-structure-template-alist
             '("el" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC" ""))
(add-to-list 'org-structure-template-alist
             '("c" "#+BEGIN_SRC C\n?\n#+END_SRC" ""))
(add-to-list 'org-structure-template-alist
             '("cpp" "#+BEGIN_SRC C++\n?\n#+END_SRC" ""))
(add-to-list 'org-structure-template-alist
             '("p" "#+BEGIN_SRC python\n?\n#+END_SRC" ""))
;; "Example" block for plaintext
(add-to-list 'org-structure-template-alist
             '("ex" "#+BEGIN_EXAMPLE \n?\n#+END_EXAMPLE" ""))
#+END_SRC
**** Babel / Languages
#+BEGIN_SRC emacs-lisp :noweb-ref org-babel-config :tangle no
(org-babel-do-load-languages
 'org-babel-load-languages
 '((latex . t)
   (python . t)
   (emacs-lisp . t)
   (C . t)
   (lisp . t)))
#+END_SRC
*** Links
Org link workflow:
1. save link to current location with C-c l
2. move to spot where I'd like to insert the link
3. C-c C-l to insert link
4. (TODO! Fix this annoyance:) delete the default string, because I
   basically never use the file path as the link description
5. type in my own description
6. carry on with my life
#+BEGIN_SRC emacs-lisp :noweb-ref org-links :tangle no
(defun org-link-describe (link desc)
  (if (file-exists-p link)
      desc
    (read-string "Description: " nil)))
(setf org-make-link-description-function #'org-link-describe)
#+END_SRC

*** Org tables
Source: https://emacs.stackexchange.com/a/30871
#+BEGIN_SRC emacs-lisp :noweb-ref org-tables :tangle no
(defun org-table-wrap-to-width (width) 
  "Wrap current column to WIDTH."
  (interactive (list (read-number "Enter column width: ")))
  (org-table-check-inside-data-field)
  (org-table-align)

  (let (cline (ccol (org-table-current-column)) new-row-count (more t))
    (org-table-goto-line 1)
    (org-table-goto-column ccol)

    (while more
      (setq cline (org-table-current-line))

      ;; Cut current field
      (org-table-copy-region (point) (point) 'cut)

      ;; Justify for width
      (setq org-table-clip 
            (mapcar 'list (org-wrap (caar org-table-clip) width nil)))

      ;; Add new lines and fill
      (setq new-row-count (1- (length org-table-clip)))
      (if (> new-row-count 0)
          (org-table-insert-n-row-below new-row-count)) 
      (org-table-goto-line cline)
      (org-table-goto-column ccol)
      (org-table-paste-rectangle)
      (org-table-goto-line (+ cline new-row-count))

      ;; Move to next line
      (setq more (org-table-goto-line (+ cline new-row-count 1)))
      (org-table-goto-column ccol))

    (org-table-goto-line 1)
    (org-table-goto-column ccol)))

;; ;; Default cell width
;; (setq org-cell-fill-column 50)

;; ;; Define a dwim, so the regular binding for M-q still works when I'm not in an
;; ;; org-table data field
;; (defun org-table-fill-dwim
;;     (if (org-table-check-inside-data-field)
;;         (org-table-wrap-to-width)
;;       (fill-paragraph)))

;; (add-hook 'org-mode-hook
;;           (lambda () (bind-key "M-q" #'org-table-fill-dwim)))

(defun org-table-insert-n-row-below (n)
  "Insert N new lines below the current."
  (let* ((line (buffer-substring (point-at-bol) (point-at-eol)))
         (new (org-table-clean-line line)))
    ;; Fix the first field if necessary
    (if (string-match "^[ \t]*| *[#$] *|" line)
        (setq new (replace-match (match-string 0 line) t t new)))
    (beginning-of-line 2)
    (setq new
      (apply 'concat (make-list n (concat new "\n"))))
    (let (org-table-may-need-update) (insert-before-markers new))  ;;; remove? 
    (beginning-of-line 0)
    (re-search-forward "| ?" (point-at-eol) t)
    (and (or org-table-may-need-update org-table-overlay-coordinates) ;;; remove? 
         (org-table-align))
    (org-table-fix-formulas "@" nil (1- (org-table-current-dline)) n)))

;; (global-set-key (kbd "C-c M-q") org-table-))
#+END_SRC
** Helm
*** Introduction to helm
- Definition of "helm": noun - a tiller or wheel and any associated
  equipment for steering a ship or boat.
  - "she stayed at the helm, alert for tankers"
  - synonyms: tiller, wheel; steering gear, rudder
- As you may have anticipated, it's also an Emacs package
- I include the definition of the common word, because it sums up the
  package well; Helm is an interface for "steering" interactions. In
  particular, Helm provides a search interface which filters results
  visually.
  - If you do C-s and then press tab twice, a list of suggestions pops
    up. Helm skips the bullshit and shows suggestions from the get-go
  - The functionality is similar to how Google searches will give a
    real-time popup with common queries that match what you've typed.
- In particular, Helm provides serious enhancement for the following:
  - searches within files (C-s)
  - navigation to files on your filesystem (C-x f)
  - buffer selection (C-x b)
  - M-x commands (the default binding for execute-extended-command)
*** Config
#+BEGIN_SRC emacs-lisp :noweb tangle
(message "[krista] Loading helm...")
(use-package helm
  :diminish helm-mode
  ;; helm-config is a bootstrapping package. According to
  ;;   https://github.com/emacs-helm/helm/issues/744 it's not
  ;;   required, but I checked out the source, and it looks like it
  ;;   provides some core niceties that I've enjoyed
  :init (require 'helm-config)
  :config
  ;; Enable Helm globally
  (helm-mode t)
  <<helm-behavior>>
  <<helm-recentf>>
  <<helm-ff-in-new-window>>
  :bind (
         <<helm-replace-defaults>>
         <<helm-actions>>
         ))
<<helm-descbinds>>
#+END_SRC
**** Helm behavior
Sometimes, I just want to tweak something about how Helm functions.
This is the place to put it
#+BEGIN_SRC emacs-lisp :noweb-ref helm-behavior :tangle no
;; Make it so that Helm auto-selects the only match for a query
;; Source: https://emacs.stackexchange.com/questions/13273/how-can-i-quickly-enter-a-directory-in-helm-find-file-when-there-is-only-one-to
;; Note: ff is *F*ind *F*ile
;; (setq helm-ff-auto-update-initial-value t)
#+END_SRC
**** helm-recentf
#+BEGIN_SRC emacs-lisp :noweb-ref helm-recentf :tangle no
(message "[krista] Loading helm-recentf...")
(require 'recentf)
(recentf-mode t)
(setq recentf-max-menu-items 200)
(setq recentf-max-saved-items 200)
(setq helm-recentf-max-menu-items 200)

;; Auto-save a list of recently-opened files
;; NOTE: This ensures accurate recentf info in case of a
;; less-than-graceful exit
(setq krista/recentf-save-interval 300)
(run-at-time (current-time) krista/recentf-save-interval 'recentf-save-list)
#+END_SRC
**** Find file + open new window
Source: https://emacs.stackexchange.com/a/20845
#+BEGIN_SRC emacs-lisp :noweb-ref helm-ff-in-new-window :tangle no
(defun helm-buffer-switch-to-new-window (_candidate)
  "Display buffers in new windows."
  ;; Select the bottom right window
  (require 'winner)
  (select-window (car (last (winner-sorted-window-list))))
  ;; Display buffers in new windows
  (dolist (buf (helm-marked-candidates))
    (select-window (split-window-right))
    (switch-to-buffer buf))
  ;; Adjust size of windows
  (balance-windows))

(defun helm-buffer-switch-new-window ()
  (interactive)
  (with-helm-alive-p
   (helm-quit-and-execute-action 'helm-buffer-switch-to-new-window)))

;; NOTE: Change this with the keybinding for helm-buffer-switch-new-window!!!
(add-to-list 'helm-type-buffer-actions
             '("Display buffer(s) in new window(s) with C-x M-f" .
               helm-buffer-switch-new-window) 'append)
;; NOTE: Change this keybinding with the help-text, helm-type-buffer-actions
(define-key helm-buffer-map (kbd "C-x M-f") #'helm-buffer-switch-new-window)
;; Usage: C-x C-f as normal, but open with C-o
#+END_SRC
**** Override global keybindings (replace defaults)
I like Helm so much that I'm willing to override the corresponding
default Emacs functions. Also, Emacs defaults are "meh".
#+BEGIN_SRC emacs-lisp :noweb-ref helm-replace-defaults :tangle no
("M-x" . helm-M-x)
;; NOTE: don't forget that you can use helm-locate for fuzzy file searching
;; (e.g. equivalent to mdfind on macOS)
("C-x C-f" . helm-find-files)
("C-x C-r" . helm-recentf)

;; helm-mini shows recentf, the buffers list, and a "create buffer" prompt
("C-x b" . helm-mini)

;; helm-buffers-list just shows the buffers list
("C-x C-b" . helm-buffers-list)

;; Display bookmarks for frequently-visited spots on my file system
("C-x r l" . helm-bookmarks)
#+END_SRC
**** helm actions
#+BEGIN_SRC emacs-lisp :noweb-ref helm-actions :tangle no
;; :map helm-map
;; Helm persistent action does something useful for the given context, without
;; closing the helm popup
;; ("<tab>" . helm-execute-persistent-action)
;; ("C-i" . helm-execute-persistent-action) ; for use in terminal
;; helm-select-action pulls up a menu of more complex actions that you can take
;; in a given context
;; ("C-z" . helm-select-action)
#+END_SRC
**** helm-descbinds (*desc*-ribe *bind*-ings)
- Helm descbinds is a smarter replacement for "C-h k" to look up
  functions by keybinding
- Invoke with "C-h b"
- Press TAB for options (e.g. execute the selected command, look up
  documentation, etc.)
#+BEGIN_SRC emacs-lisp :noweb-ref helm-descbinds :tangle no
(message "[krista] Loading helm-descbinds...")
(use-package helm-descbinds
  :diminish helm-descbinds-mode
  :config (setq helm-descbinds-mode t)
  :bind ("C-h b" . helm-descbinds))
#+END_SRC
** Helm swoop
- Swoop is like a better isearch. Works really nicely with helm.
- [[https://github.com/ShingoFukuyama/helm-swoop][ShingoFukuyama's super-fancy helm config]]
- Editing from Helm swoop. When doing C-s, you can
  - do "C-c C-e" to edit all matching lines
  - select lines with C-<space>, and /then/ do "C-c C-e" to edit just
    the /selected/ lines
#+BEGIN_SRC emacs-lisp :noweb tangle
(message "[krista] Loading helm-swoop...")
(use-package helm-swoop
  :config <<helm-swoop-syntax-highlighting>>
  <<helm-swoop-reactivate-mark>>
  <<helm-swoop-behavior>>
  <<helm-swoop-aesthetics>>
  :bind 
  ;; Use swoop instead of isearch
  (("C-s" . helm-swoop-without-pre-input)
   ;; r is for "Reuse", b/c this reuses the input from the last query
   ("C-r" . helm-swoop)

   ;; M-s is for multi-swoop
   ;; ...TODO write a description for multi-swoop
   ("C-M-s" . helm-multi-swoop-projectile)

   ;; Bindings so I can still use isearch (if for some crazy reason, I
   ;; want to use isearch rather than swoop)
   ("C-c s" . isearch-forward)
   ("C-c r" . isearch-backward)))
#+END_SRC
**** Keep syntax highlighting
Retain syntax highlighting in swoop. It's a tradeoff between this and
speed, but I think that it's worth the (teeny!) speed hit.
#+BEGIN_SRC emacs-lisp :noweb-ref helm-swoop-syntax-highlighting :tangle no
(setq helm-swoop-speed-or-color t)
#+END_SRC
**** Mark reactivation
- Source: Spruce Bondera's fabulous config page 
- Description: For some reason helm-swoop deactivates the mark on
  search selection. This wrapper fixes that, by wrapping helm-swoop in
  a function that will reactivate the mark if it was set before search
  started.
#+BEGIN_SRC emacs-lisp :noweb-ref helm-swoop-reactivate-mark :tangle no
(defun krista/helm-swoop-mark-wrapper (original &rest search)
  "Check the state of the mark before calling helm-swoop and
  re-activate it after swooping if it was active before-hand"
  (let ((marked mark-active))
    (apply original search)
    (when marked (activate-mark))))
(advice-add 'helm-swoop :around #'krista/helm-swoop-mark-wrapper)
#+END_SRC
**** behavior
#+BEGIN_SRC emacs-lisp :noweb-ref helm-swoop-behavior :tangle no
;; If you're at the bottom of the list of swoop matches, and you try
;; to go down another line, then you wrap around again
(setq helm-swoop-move-to-line-cycle t)

;; Enable fuzzy matching
(setq helm-swoop-use-fuzzy-match nil)
#+END_SRC
**** aesthetics
#+BEGIN_SRC emacs-lisp :noweb-ref helm-swoop-aesthetics :tangle no
;; Face for directories in the find-file popup
(set-face-attribute 'helm-ff-directory nil
                    :foreground "#42071d"
                    :background "#00a890")
(set-face-attribute 'helm-ff-executable nil
                    :foreground "green"
                    :underline t)

(set-face-attribute 'helm-source-header nil
                    :background "turquoise4"
                    :foreground "#f0ffff"
                    :weight 'semi-bold
                    :height 1.3
                    :family "Fira Code")

(set-face-attribute 'helm-swoop-target-word-face nil
                    :background "#00d4d4"
                    :foreground "#f0ffff")
(set-face-attribute 'helm-selection nil
                    :foreground "#f0ffff"
                    :background "#cf7a00"
                    :weight 'semi-bold)
(set-face-attribute 'helm-swoop-target-line-face nil
                    :foreground "#f0ffff"
                    :background "#804532"
                    :weight 'semi-bold)

#+END_SRC
*** Helm window splitting
#+BEGIN_SRC emacs-lisp
;; nil => split within this window
;;(setq helm-full-frame nil)
;; If nil don’t split and replace helm-buffer by the action buffer
;; in same window.
;;(setq helm-show-action-window-other-window nil)

;; If you have your frame like this:
;;  --------------
;;  |      |     |
;;  |      |     |
;;  |  *   |     |
;;  |active|other|
;;  --------------
;;
;; and then do M-x, I do NOT want helm to do this:
;;  --------------
;;  |      |     |
;;  |      |     |
;;  |      |  *  |
;;  |active|helm |
;;  --------------
;; 
;; Instead, I want helm to do THIS:
;;  --------------
;;  |      |     |
;;  |active|     |
;;  |------|     |
;;  |helm *|other|
;;  --------------
;;
;; Source: https://github.com/emacs-helm/helm/issues/169
;; This line keeps helm on the same side
;; (setq helm-split-window-default-side 'same)
;; open helm buffer inside current window, don't occupy whole other window
(setq helm-split-window-in-side-p t)

;; Split windows in half like *this*:
;; ------------
;; |          |
;; |  Buffer  |
;; |          |
;; ------------
;; |   Helm   |
;; ------------
(setq helm-swoop-split-direction 'split-window-vertically)

;; Even if there are multiple windows open, /still/ split the window
;; in half
(setq helm-swoop-split-with-multiple-windows t)
#+END_SRC
** Company
*** company (COM-plete ANY-thing)
#+BEGIN_SRC emacs-lisp
(use-package company 
  :diminish
  :config
  (global-company-mode)
  :bind (("C-;" . company-complete)))

;; Scroll through completion options with C-n and C-p (instead of M-n
;; and M-p)
;; Source: https://emacs.stackexchange.com/a/2990
(with-eval-after-load 'company
  (define-key company-active-map (kbd "M-n") nil)
  (define-key company-active-map (kbd "M-p") nil)
  (define-key company-active-map (kbd "C-n") #'company-select-next)
  (define-key company-active-map (kbd "C-p") #'company-select-previous))

(custom-set-faces
 ;; Auto-completion preview (for the case where there's a unique suggestion)
 ;; ------------------------------------------------------------------------
 '(company-preview
   ((t (:foreground "darkgray" :underline t :family "Fira Code"))))
 '(company-preview-common
   ((t (:inherit company-preview :foreground "#cf7a00"))))
 
 ;; Scrollbar
 ;; ----------
 '(company-scrollbar-fg
   ((t (:background "#804532"))))
 '(company-scrollbar-bg
   ((t (:background "#19343D"))))

 ;; Tooltips
 ;; -----------
 ;; In case you're wondering, this is what a "tooltip" looks like
 ;; http://www.goldsborough.me/images/emacs-java/correcting.png
 '(company-tooltip
   ((t (:background "#19343D" :foreground "#306158"))))
 '(company-tooltip-selection
   ((t (:background "#cf7a00" :foreground "#a0ffff" :weight bold))))
 '(company-tooltip-common
   ((((type x)) (:inherit company-tooltip :weight bold))
    (t (:inherit company-tooltip))))
 '(company-tooltip-common-selection
   ((((type x)) (:inherit company-tooltip-selection :weight bold))
    (t (:inherit company-tooltip-selection))))

 ;; TODO: move this
 '(org-date ((t (:foreground "Cyan" :underline "#075f5f")))))
#+END_SRC
*** helm-company
- company uses popup/tooltip-style suggestions which appear under the point
- sometimes, I want to navigate through the completion options using helm
- solution: helm-company
#+BEGIN_SRC emacs-lisp
(with-eval-after-load 'company
  (use-package helm-company :diminish)
  (bind-key "C-'"  'helm-company company-mode-map)
  (bind-key "C-'" 'helm-company company-active-map))
#+END_SRC
** Projectile
*** Projectile proper
#+BEGIN_SRC emacs-lisp
(message "[krista] Loading projectile...")
(use-package projectile
  :diminish
  :config
  (setq projectile-completion-system 'helm)
  (projectile-global-mode))
#+END_SRC
*** Helm projectile
#+BEGIN_SRC emacs-lisp
(use-package helm-projectile
  :config
  (with-eval-after-load 'projectile (helm-projectile-on))
  (setq projectile-mode t))
#+END_SRC
** Magit
*** [[https://www.masteringemacs.org/article/introduction-magit-emacs-mode-git][Magit tutorial]]
*** Config
#+BEGIN_SRC emacs-lisp :noweb tangle
(message "[krista] Loading magit...")
(use-package magit
  :config
  <<magit-color-scheme>>
  ;; Default arguments to magit log
  (setq magit-log-arguments '("-n150" "--graph" "--decorate" "--color"))
  :bind
  (("C-c g" . magit-status)))
#+END_SRC
*** Color scheme
Note: "vc" stands for *V*-ersion *C*-ontrol
#+BEGIN_SRC emacs-lisp :noweb-ref magit-color-scheme :tangle no
(setq vc-annotate-background nil)
(setq vc-annotate-color-map
      (quote
       ((20 . "#f2777a")
        (40 . "#f99157")
        (60 . "#ffcc66")
        (80 . "#99cc99")
        (100 . "#66cccc")
        (120 . "#6699cc")
        (140 . "#cc99cc")
        (160 . "#f2777a")
        (180 . "#f99157")
        (200 . "#ffcc66")
        (220 . "#99cc99")
        (240 . "#66cccc")
        (260 . "#6699cc")
        (280 . "#cc99cc")
        (300 . "#f2777a")
        (320 . "#f99157")
        (340 . "#ffcc66")
        (360 . "#99cc99"))))
(setq vc-annotate-very-old-color nil)
#+END_SRC
* Minor packages
** Cheatsheet
*** What is cheatsheet?
Cheatsheet gives quick access to read-only buffers.
Use case: peeking at cheat sheets!
Github page: https://github.com/darksmile/cheatsheet/
*** How to use cheatsheet
**** Pull up your cheatsheet :: cheatsheet-show
- Show buffer with your cheatsheet!
- Use H-c to show the cheatsheet
- Use C-q to exit the cheatsheet
**** Add a new cheat to your cheatsheet :: cheatsheet-add
Here's an example cheat. Follow this format in your config
#+BEGIN_SRC example
(cheatsheet-add :group 'Common
                :key "C-x C-c"
                :description "leave Emacs.")
#+END_SRC
*** Krista's cheatsheet entries
#+BEGIN_SRC emacs-lisp :noweb tangle
(message "[krista] Loading cheatsheet...")
(use-package cheatsheet
  :config
  <<common-cheats>>
  <<LaTeX-cheats>>
  <<org-cheats>>
  <<magit-cheats>>
  <<projectile-cheats>>
  <<builtin-cheats>>
  :bind (("H-c" . cheatsheet-show)))
#+END_SRC
**** Common cheats for use throughout Emacs
#+BEGIN_SRC emacs-lisp :noweb-ref common-cheats :tangle yes
(cheatsheet-add :group 'Getting_around
                :key "C-d"
                :description "Kill --> one character")
(cheatsheet-add :group 'Getting_around
                :key "M-d"
                :description "Kill --> to end of word")
(cheatsheet-add :group 'Getting_around
                :key "C-DEL -or- M-DEL"
                :description "Kill <-- to beginning of word")
(cheatsheet-add :group 'Getting_around
                :key "M-@"
                :description "Mark --> to end of word")
(cheatsheet-add :group 'Getting_around
                :key "C-t"
                :description "Swap the character at the mark w/the character before it")
(cheatsheet-add :group 'Getting_around
                :key "M-t"
                :description "Swap the word at the mark w/the word before it")
#+END_SRC
**** LaTeX cheats
Much thanks goes to the AUCTeX Reference Card for version 11.89
#+BEGIN_SRC emacs-lisp :noweb-ref LaTeX-cheats :tangle no
(cheatsheet-add :group 'LaTeX:document_structure ; see "Command Insertion" in the AUCTeX sheet
                :key "C-c C-s"
                :description "Insert section")
(cheatsheet-add :group 'LaTeX:document_structure
                :key "M-RET"
                :description "Insert item")
(cheatsheet-add :group 'LaTeX:document_structure
                :key "C-c ]"
                :description "Close LaTeX environment")

                                        ; Typeface commands: C-c C-f C-[whatever]
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-b"
                :description "Bold")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-i"
                :description "Italics")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-r"
                :description "\\text{} in math mode")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-e"
                :description "\\emph{}")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-t"
                :description "typewriter-style text")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-s"
                :description "(forward-) slanted text")
(cheatsheet-add :group 'LaTeX:typeface
                :key "C-c C-f C-c"
                :description "smallcaps")

                                        ; Source formatting commands: C-c C-q C-[whatever]
(cheatsheet-add :group 'LaTeX:source_formatting
                :key "C-c C-q C-s"
                :description "Align section")
(cheatsheet-add :group 'LaTeX:source_formatting
                :key "C-c C-q C-s"
                :description "Align environment")
(cheatsheet-add :group 'LaTeX:source_formatting
                :key "M-q"
                :description "Align paragraph")
(cheatsheet-add :group 'LaTeX:source_formatting
                :key "C-c *"
                :description "Mark section")
(cheatsheet-add :group 'LaTeX:source_formatting
                :key "C-c ."
                :description "Mark environment")

                                        ; Math abbreviations: `[whatever]
(cheatsheet-add :group 'LaTeX:math_abbrevs:fancy_letters
                :key "` c"
                :description "\\mathcal{}")
(cheatsheet-add :group 'LaTeX:math_abbrevs:fancy_letters
                :key "` ~"
                :description "\\tilde{}")
(cheatsheet-add :group 'LaTeX:math_abbrevs:fancy_letters
                :key "` ^"
                :description "\\hat{}")

(cheatsheet-add :group 'LaTeX:math_abbrevs:arrows
                :key "` C-f"
                :description "\\rightarrow")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arrows
                :key "` C-b"
                :description "\\leftarrow")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arrows
                :key "` C-p"
                :description "\\uparrow")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arrows
                :key "` C-n]"
                :description "\\downarrow")

(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` I"
                :description "\\infty")
(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` A"
                :description "\\forall")
(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` E"
                :description "\\exists")
(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` i"
                :description "\\in")
(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` |"
                :description "\\vee")
(cheatsheet-add :group 'LaTeX:math_abbrevs:logic
                :key "` &"
                :description "\\wedge")

(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` 0"
                :description "\\emptyset")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` \\"
                :description "\\setminus")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` +"
                :description "\\cup")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` -"
                :description "\\cap")

(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` {"
                :description "\\subset")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` }"
                :description "\\supset")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` ["
                :description "\\subseteq")
(cheatsheet-add :group 'LaTeX:math_abbrevs:sets
                :key "` ]"
                :description "\\supseteq")

(cheatsheet-add :group 'LaTeX:math_abbrevs:arithmetic
                :key "` <"
                :description "\\leq")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arithmetic
                :key "` >"
                :description "\\geq")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arithmetic
                :key "` *"
                :description "\\times")
(cheatsheet-add :group 'LaTeX:math_abbrevs:arithmetic
                :key "` ."
                :description "\\cdot")

(cheatsheet-add :group 'LaTeX:math_abbrevs:trig
                :key"` C-e"
                :description "\\exp")

(cheatsheet-add :group 'LaTeX:math_abbrevs:trig
                :key"` C-s"
                :description "\\sin")

(cheatsheet-add :group 'LaTeX:math_abbrevs:trig
                :key"` C-c"
                :description "\\cos")

(cheatsheet-add :group 'LaTeX:math_abbrevs:trig
                :key"` C-t"
                :description "\\tan")

(cheatsheet-add :group 'LaTeX:math_abbrevs:analysis
                :key"` C-^"
                :description "\\sup")

(cheatsheet-add :group 'LaTeX:math_abbrevs:analysis
                :key"` C-_"
                :description "\\inf")

(cheatsheet-add :group 'LaTeX:math_abbrevs:analysis
                :key"` C-l"
                :description "\\lim")

(cheatsheet-add :group 'LaTeX:math_abbrevs:analysis
                :key"` C-d"
                :description "\\det")
#+END_SRC
**** Org-mode cheats
#+BEGIN_SRC emacs-lisp :noweb-ref org-cheats :tangle no
(cheatsheet-add :group 'org
                :key "
,#+attr_org: :width 300 
,#+attr_latex :width 3in :placement [H] 
[[file:./my_image.png]]"
                    :description "Add image inline")
#+END_SRC
**** Magit cheats
***** [[*Magit][Magit use-package entry]]
***** Config
#+BEGIN_SRC emacs-lisp :noweb-ref magit-cheats :tangle no
(cheatsheet-add :group 'magit
                :key "C-c g"
                :description "Enter magit menu")
(cheatsheet-add :group 'magit
                :key "(from status menu) h"
                :description "HALP")
(cheatsheet-add :group 'magit
                :key "c c; [type message]; C-c C-c"
                :description "Commit staged changes; add commit msg; save commit msg and finish")
#+END_SRC
**** Projectile cheats
#+BEGIN_SRC emacs-lisp :noweb-ref projectile-cheats :tangle no
(cheatsheet-add :group 'projectile
                :key "C-c p s s"
                :description "search")
(cheatsheet-add :group 'projectile
                :key "C-c p r"
                :description "find-replace")
(cheatsheet-add :group 'projectile
                :key "C-c p f"
                :description "file-find")
(cheatsheet-add :group 'projectile
                :key "C-c p a"
                :description "switch to related file (e.g. header)")
(cheatsheet-add :group 'projectile
                :key "C-c p k"
                :description "kill all buffers for current project")
(cheatsheet-add :group 'projectile
                :key "C-c p <Shift>+s"
                :description "save all buffers for current project")
#+END_SRC
**** Built-in emacs help
[[http://stackoverflow.com/questions/965263/given-an-emacs-command-name-how-would-you-find-key-bindings-and-vice-versa][Source]]
#+BEGIN_SRC emacs-lisp :noweb-ref builtin-cheats :tangle yes
(cheatsheet-add :group 'builtin_help
                :key "C-h c [command-name]"
                :description "Look up the keybinding for a given command")
(cheatsheet-add :group 'builtin_help
                :key "C-h k [key-sequence]"
                :description "Look up the command for a given keybinding")
(cheatsheet-add :group 'builtin_help
                :key "C-h f [function-name]"
                :description "Look up the docs for a command")
(cheatsheet-add :group 'builtin_help
                :key "C-h ?"
                :description "Help for getting more help")
#+END_SRC
*** TODO use popwin to make it so that
**** the cheatsheet pops up in a sensible place (just like helm), i.e. the cheatsheet does not occupy the adjacent buffer
**** closing the cheatsheet does not run "delete-window" (C-x 0) on the buffer that it occupied
*** TODO make this entire section less hideous. (Seriously, the [[*LaTeX%20cheats][LaTeX cheats]] section is p fugly)
*** NOTE: funky load behavior
It appears that the cheatsheet loads at startup time. Adding another
cheatsheet entry makes the entry pop up in the cheatsheet after
eval'ing my config, but deleting a cheatsheet entry does not update
the display until you restart Emacs.
*** TODO add the following cheats to cheatsheet
**** Copy-paste from helm / minibuffer!!! https://groups.google.com/forum/#!topic/emacs-helm/AYrrKO7E53I
** Yasnippet
*** [[https://github.com/joaotavora/yasnippet/blob/master/README.mdown][Github]]
*** [[http://cupfullofcode.com/blog/2013/02/26/snippet-expansion-with-yasnippet/index.html][Cup Full of Code tutorial (example starter snippets)]]
*** [[https://joaotavora.github.io/yasnippet/snippet-organization.html#sec-1][Joatoavora tutorial (better)]]
*** Configuration
#+BEGIN_SRC emacs-lisp
(message "[krista] Loading yasnippet...")
(use-package yasnippet
  :diminish yas-minor-mode
  :config
  (yas-global-mode t))
#+END_SRC
** Ace Window
#+BEGIN_SRC emacs-lisp
(use-package ace-window
  :bind (("M-P" . ace-window)))
#+END_SRC
** Undo tree
Docs: <http://www.dr-qubit.org/undo-tree/undo-tree-0.6.4.el>
#+BEGIN_SRC emacs-lisp
(message "[krista] Loading undo-tree...")
(require 'undo-tree)
(setq undo-tree-auto-save-history t)
(add-to-list 'undo-tree-history-directory-alist
             '("." . "~/.emacs.d/cache/undo/"))

;; WARNING!!! This line must appear /after/ setting variables to save undo-tree
;; history!!!
(global-undo-tree-mode)
#+END_SRC
** Flycheck
#+BEGIN_SRC emacs-lisp
(use-package flycheck
  :init (global-flycheck-mode)
  :diminish)
;; Permanently enable syntax checking
(add-hook 'after-init-hook #'global-flycheck-mode)
#+END_SRC
*** Usage
via http://www.flycheck.org/en/latest/user/quickstart.html#enable-
- =C-c ! n=: go forward to next error
- =C-c ! p=: go backward to prev. error
- =C-c ! l=: show a popup list of errors
** Smartparens
This config is adapted from Spruce Bondera's .emacs.d
#+BEGIN_SRC emacs-lisp
(use-package smartparens
  :config
  ;; Enable the default config
  (require 'smartparens-config)

  ;; There's several modes in which I usually prefer strings to be treated
  ;; similar to s-expressions. In others its less relevant/string literals are
  ;; less common.
  (setq sp-navigate-consider-stringlike-sexp
        (append sp-navigate-consider-stringlike-sexp (list 'python-mode
                                                           'org-mode
                                                           'coffeescript-mode)))

  ;; This overlay ended up being on basically all the time and overriding my
  ;; syntax highlighting. More distracting than helpful.

  ;; From the docs:
  ;; If non-nil, autoinserted pairs are highlighted while point is inside the pair.
  (setq sp-highlight-pair-overlay nil)

  ;; smartparens will automatically escape quotes, so if you type this:
  ;;     "The expression of the day is My Expression!"
  ;;
  ;; and then try to highlight and quote "My Expression!", you'll get this:
  ;;     "The expression of the day is \"My Expression!\""
  ;;
  ;; I don't like that. This line turns it off.
  (setq sp-escape-quotes-after-insert nil)

  :bind (("C-M-f" . sp-forward-sexp)
         ("C-M-b" . sp-backward-sexp)
         ("C-M-u" . sp-backward-up-sexp)
         ("C-M-d" . sp-down-sexp)
         ("C-M-a" . sp-backward-down-sexp)
         ("C-M-e" . sp-forward-up-sexp)
         ("C-M-n" . sp-beginning-of-next-sexp)
         ("C-M-p" . sp-beginning-of-previous-sexp)
         ;; Unwrap, or remove the parens/outer pair from the current s-exp
         ("C-M-<backspace>" . sp-unwrap-sexp)))

;; Enable smartparens globally
(smartparens-global-mode)
#+END_SRC
* Programming
** Whitespace preferences
#+BEGIN_SRC emacs-lisp
;; Show trailing whitespace by default
(message "[krista] Loading whitespace preferences...")
(use-package whitespace)
(setq-default show-trailing-whitespace nil)
                                        ;(add-hook 'before-save-hook 'delete-trailing-whitespace)
;; ... but don't show trailing whitespace if I'm in
;; - a minibuffer
;; - help mode
;; - in a makefile
(defun hide-trailing-whitespace ()
  (setq show-trailing-whitespace nil))
(add-hook 'minibuffer-setup-hook
          'hide-trailing-whitespace)
(add-hook 'help-mode-hook
          'hide-trailing-whitespace)
(add-hook 'compilation-mode-hook
          'hide-trailing-whitespace)
(add-hook 'makefile-mode-hook
          'hide-trailing-whitespace)
(add-hook 'text-mode-hook
          'hide-trailing-whitespace)
;; Function hide-trailing-whitespace is adapted from
;; the function no-trailing-whitespace, available:
;; https://ogbe.net/emacsconfig.html

(add-hook 'python-mode-hook 'whitespace-mode)
(setq whitespace-style '(trailing space-before-tab indentation empty space-after-tab lines))
(setq whitespace-action '(auto-cleanup))
(setq-default indent-tabs-mode nil)
(setq tab-width 8)
(setq-default fill-column 80)
                                        ;(defvaralias 'c-basic-offset 'tab-width)
#+END_SRC
** Programming languages
*** C / C++
#+BEGIN_SRC emacs-lisp
(message "[krista] Loading cc-mode...")
(use-package cc-mode
  :bind (:map
         c-mode-base-map
         ("C-c b" . compile)
         ("M-j" . join-line)))
;; Give me preconfigured autocompletions for C and C++!
;; (add-hook 'c-mode-hook
;;             (lambda ()
;;               (add-to-list 'ac-sources 'ac-source-c-headers)
;;               (add-to-list 'ac-sources 'ac-source-c-header-symbols t)))

                                        ; My wildly unpopular bracing style
                                        ; Secret: I really use Ratliffe, but this does the trick
(setq krista-c-style
      '((setq c-default-style "whitesmith")
        (setq-default c-basic-offset 4)))

;;(setq c-default-style "whitesmith")
;;(setq-default c-basic-offset 4)

                                        ; Alternate settings that don't piss other programmers off as much:

(setq conformity-c-style
      '((setq c-default-style "python")
        (setq-default c-basic-offset 2)))

(add-hook 'c-mode-common-hook
          (lambda () (c-add-style "krista-c-style" krista-c-style t)))
#+END_SRC
*** Python
**** Pylint minor mode
#+BEGIN_SRC emacs-lisp
(message "[krista] Loading python config...")
(autoload 'pylint "pylint")
(add-hook 'python-mode-hook 'pylint-add-menu-items)
(add-hook 'python-mode-hook 'pylint-add-key-bindings)
#+END_SRC
**** Python shell interpreter
- Problem: When I ran =run-python=, I got the following error message:
  - Warning (python): Your ‘python-shell-interpreter’ doesn’t seem to
    support readline, yet ‘python-shell-completion-native’ was t and
    "python" is not part of the
    ‘python-shell-completion-native-disabled-interpreters’ list.
    Native completions have been disabled locally.
- Solution (via [[https://emacs.stackexchange.com/a/30970][this]]):
  #+BEGIN_SRC emacs-lisp
  (with-eval-after-load 'python
    (defun python-shell-completion-native-try ()
      "Return non-nil if can trigger native completion."
      (let ((python-shell-completion-native-enable t)
            (python-shell-completion-native-output-timeout
             python-shell-completion-native-try-output-timeout))
        (python-shell-completion-native-get-completions
         (get-buffer-process (current-buffer))
         nil "_"))))
  #+END_SRC
**** Press <tab> to indent with 4 spaces
#+BEGIN_SRC emacs-lisp
(add-hook 'python-mode-hook
          (lambda ()
            (setq indent-tabs-mode nil)
            (setq tab-width 4)
            (setq python-indent 4)))
#+END_SRC
*** Slime (lisp)
#+BEGIN_SRC emacs-lisp
;; (load (expand-file-name "~/core/dev/builds_from_source/quicklisp/slime-helper.el"))
;; The SBCL binary and command-line arguments
;; (setq inferior-lisp-program "/usr/local/bin/sbcl --noinform")
#+END_SRC
*** haskell
#+BEGIN_SRC emacs-lisp
(use-package haskell-mode)
#+END_SRC
* Getting help
This section is not part of my config file per say, but contains instructions
for getting help with various parts of emacs
** How-to's
*** [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Key-Binding-Commands.html][Keybinding instructions]]
*** How to edit source code in org-mode file
- New code block:
  - New source block (lang unspecified): <s [TAB]
  - New elisp block: <el [TAB]
- Edit code block: C-c'
*** Embed an image in an org document
#+BEGIN_EXAMPLE
,#+CAPTION: This is the caption for the next figure link (or table)
,#+attr_org: :width="50px"
,#+NAME:   figure
[[file:./my_image.png]]
#+END_EXAMPLE
*** Select all: C-x h
*** Moving a file into the 'literate' directory:
Suppose you made a file called =new-thing=
#+BEGIN_EXAMPLE 
;; Macro to define a new external tangling file:
(krista/new-config-file new-thing "new-thing")
;; Actually load the external file:
'(org-babel-load-file krista/my-new-config-file)
#+END_EXAMPLE
** Troubleshooting your config file
If you don't know why your emacs is breaking, but suspect a tangling
issue, then CHECK CONFIG.EL
** Helpful resources
*** Within emacs
- =M-x describe-[key, face, mode, etc.]=
  - =C-h [k, o, f, m]=: Quick keybindings for the describe-.* functions
- For helm: [[*helm-descbinds%20(*desc*-ribe%20*bind*-ings)][*helm-descbinds (*desc*-ribe *bind*-ings)]]
- Custom help written by me: [[*Cheatsheet]]
*** Online
- http://pages.sachachua.com/.emacs.d/Sacha.html
- http://ergoemacs.org/emacs/emacs.html
- https://emacsdojo.github.io/
* Further plans
** TODO Kinesis-specific keyboard issues
- My hands were hurting after long typing sessions. As a computer
  science student, I forsaw this as being a potentially-huge problem
  later on in life. So I decided to get a Kinesis Advantage 2 while I
  was still young, springy, and stupid enough to consider adapting my
  muscle memory to a new keyboard style. (...but fuck Dvorak. I ain't
  crazy enough for Dvorak.) 2 weeks later, my new Kinesis arrived. I
  plugged her into my Mac, and with a perverse glee, I started up
  Emacs to see what was broken. Here, I shall document those things.
- First, I live in the U.S. This keyboard therefore shipped with a
  P.C. layout. I followed the instructions for "Mac Mode", as per
  the quickstart guide. It should be noted that before switching, my
  layout was modified from the stock OS X layout as follows:
- Global modifications:
** TODO Integrated compiler / version control / logging facility
- I've noticed that when coding in a compiled language such as C/C++,
  I often end up in this workflow:
  - Type some stuff
  - Save
  - Try compiling
  - If compiler errors
    - Make note of what's wrong
    - Try to solve the problem
    - Try compiling again
- It would be nice to be able to record the flow of [compiler error /
  troubleshooting idea / fix] for the purposes of version control
- I want a package that will let me have a debugging diary which will
  archive my code, compiler output, and any thoughts that i'd like to
  record.
- Ideally, the package would output an org doc with an undo-tree -like
  interface for retracing my steps in debugging
** TODO Set up steam integration with emacs
** TODO Emacs/W3
#+BEGIN_SRC emacs-lisp
;; (setq load-path (cons "/usr/share/emacs/site-lisp" load-path))
;; (condition-case () (require 'w3-auto "w3-auto") (error nil))
#+END_SRC
** TODO multiple-cursors
#+BEGIN_SRC emacs-lisp
;; (use-package multiple-cursors
;;  :bind (("C-S-c C-S-c" . mc/edit-lines)))
#+END_SRC
** TODO +Install Corral+ Figure out smartparens
Apparently, the package does more than just automatically add the closing paren!
** TODO Add more to yasnippet
** TODO Install the alert package
- provides Growl-like notifications
- would be useful for org-calendar
* heap
#+BEGIN_SRC emacs-lisp
(defun revert-buffer-no-prompt ()
  "Revert buffer without confirm prompt"
  (interactive)
  (revert-buffer t t))
#+END_SRC
